<script src="vendor/base64.js"></script>
<script src="transfer_browse.js"></script>

<div ng-app="transferBrowse">
<div ng-controller="HeaderController as vm">
  <label for="transfer-type">Transfer type</label>
  <select ng-model="vm.transfer.type" ng-disabled="vm.transfer.components.length > 0">
    <option value="standard" selected>Standard</option>
    <option value="unzipped bag">Unzipped Bag</option>
    <option value="zipped bag">Zipped bag</option>
    <option value="dspace">DSpace</option>
    <option value="disk image">Disk Image</option>
  </select>

  <label for="transfer-name">Transfer name</label>
  <input ng-model="vm.transfer.name"/>

  <label for="transfer-accession">Accession no.</label>
  <input ng-model="vm.transfer.accession"/>

  <button type="submit"
          class="btn btn-success"
          ng-disabled="!vm.transfer.name || vm.transfer.components.length === 0"
          ng-click="vm.transfer.start()">Start transfer</button>

  <button type="submit"
          class="btn btn-default"
          ng-if="vm.transfer.type == 'disk image'"
          ng-click="vm.add_next_metadata()"
          title="Metadata entered in this form will be associated with the next component added to this transfer. Data will not be used if no component is added after the form is saved.">
    Add next
  </button>

  <div id="path_container">
    <div ng-repeat="component in vm.transfer.components" id="transfer-component-path-item-{{ $index + 1 }}">
      <span class="transfer_path">{{ component.path }}</span>
      <span class="transfer_path_icons">
        <span ng-if="vm.transfer.type == 'disk_image'" class="transfer_path_edit_icon" ng-click="vm.open_edit_page(component)">
          <img src="/media/images/table_edit.png">
        </span>
        <span class="transfer_path_delete_icon" ng-click="vm.remove_component(component)">
          <img src="/media/images/delete.png">
        </span>
      </span>
    </div>
  </div>
</div>

<div ng-controller="BrowseController as vm">
  <select ng-model="vm.source_location" ng-change="vm.browse(vm.source_location)">
    <option ng-repeat="(location_uuid, location) in vm.source_locations" value="{{ location_uuid }}">{{ location.description }}</option>
  </select>

  <button type="submit" class="btn btn-default" ng-click="vm.transfer.add_component(vm.selected)" ng-disabled="!vm.selected || !vm.file_can_be_added(vm.selected)">Add</button>

  <treecontrol class="tree-classic"
               tree-model="vm.data"
               options="vm.options"
               selected-node="vm.selected"
               on-node-toggle="vm.on_toggle(node, expanded)">
    {{ node.title }} ({{ node.properties.display_string }})
  </treecontrol>
</div>
</div>
